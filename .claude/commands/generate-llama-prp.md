# 生成llama.cpp PRP (Product Requirements Prompt)

基于INITIAL.md文件生成一个全面的llama.cpp开发PRP文档，包含C++最佳实践、CUDA优化、性能测试和验证循环。

## 输入
参数: `$ARGUMENTS` - INITIAL.md文件的路径或任何需求描述文件

## 输出
在PRPs/目录中生成一个详细的PRP文档，文件名基于功能描述。

## 工作流程

你是llama.cpp专家开发助手。你的任务是创建一个全面的PRP (Product Requirements Prompt)，用于实现用户在INITIAL.md中描述的llama.cpp功能。

### 第1步: 阅读和理解需求
首先读取用户提供的需求文件:

```
读取文件: $ARGUMENTS
分析要求实现的功能
识别关键技术需求 (性能、CUDA支持、量化等)
```

### 第2步: 研究llama.cpp生态系统
使用网络搜索广泛研究相关的llama.cpp模式和最佳实践:

```
搜索主题:
- "llama.cpp [功能关键词] implementation"
- "llama.cpp CUDA [相关技术] optimization" 
- "ggml tensor [操作类型] examples"
- "llama.cpp quantization [具体方案] code"
- "llama.cpp performance optimization [领域]"
```

### 第3步: 分析代码库模式
检查现有的llama.cpp代码结构和模式:

```
重点分析:
- src/llama.cpp - 核心API模式
- ggml-*.cu - CUDA实现模式  
- examples/ - 使用模式
- tests/ - 测试模式
- CMakeLists.txt - 构建模式
```

### 第4步: 识别相关文档和示例
收集所有相关的技术文档:

```
包含:
- GitHub仓库链接和关键文件
- 性能优化指南
- CUDA编程最佳实践
- 现有类似功能的实现
- 已知的陷阱和解决方案
```

### 第5步: 生成综合PRP
使用PRPs/templates/prp_llama_cpp_base.md作为模板，生成包含以下内容的详细PRP:

#### PRP结构要求:
1. **明确的目标和成功标准**
   - 具体的性能目标 (延迟、吞吐量、内存使用)
   - 数值精度要求
   - 兼容性目标 (CPU/GPU, 不同量化级别)

2. **完整的上下文信息**
   - 所有相关的GitHub链接和文档
   - 现有代码模式的具体文件引用
   - 关键的llama.cpp和ggml概念解释
   - 性能基准和参考实现

3. **详细的实现蓝图**
   - C++类设计和内存管理模式
   - CUDA kernel设计 (如果需要GPU支持)
   - 与现有API的集成点
   - 错误处理和边界条件

4. **分步实现计划**
   - 按依赖关系排序的任务列表
   - 每个任务的具体文件修改说明
   - 关键代码模式的伪代码示例
   - 测试和验证要求

5. **多层验证循环**
   - 编译和静态分析检查
   - 单元测试 (正确性和边界情况)
   - 性能基准测试
   - 内存泄漏和安全检查
   - 跨平台兼容性测试

6. **已知陷阱和最佳实践**
   - llama.cpp特定的编程陷阱
   - CUDA内存管理注意事项
   - SIMD优化要求
   - 跨平台编译问题

#### 质量标准:
- **信息密度**: 包含足够的技术细节供专家级实现
- **可执行性**: 每个步骤都有明确的验收标准
- **完整性**: 覆盖从设计到测试的完整开发周期
- **实用性**: 基于真实的llama.cpp开发模式

### 第6步: 置信度评估
评估PRP的完整性和可行性:

```
评估标准:
- 是否包含所有必要的技术上下文?
- 实现计划是否现实可行?
- 验证步骤是否充分?
- 是否考虑了主要的风险和陷阱?

置信度分数: [1-10]
```

### 第7步: 保存PRP
将生成的PRP保存到适当的文件:

```
文件名格式: PRPs/[功能描述]-[日期].md
例如: PRPs/q4_0_cuda_optimization-2024-01-15.md
```

## 输出示例

生成的PRP应该是一个可以直接用于`/execute-llama-prp`命令的完整文档，包含:

- 明确的技术目标和成功标准
- 完整的实现上下文和参考资料
- 详细的分步实现计划
- 全面的测试和验证策略
- 高质量C++/CUDA代码的指导原则

PRP应该足够详细，让AI编程助手能够端到端地实现功能，包括处理边界情况、优化性能和确保代码质量。